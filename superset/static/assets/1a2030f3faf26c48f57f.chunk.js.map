{"version":3,"file":"1a2030f3faf26c48f57f.chunk.js","mappings":"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","sources":["webpack://superset/./packages/superset-ui-core/src/utils/getSelectedText.ts","webpack://superset/./node_modules/@ant-design/icons/es/icons/PlusSquareOutlined.js","webpack://superset/./node_modules/@ant-design/icons/es/icons/MinusSquareOutlined.js","webpack://superset/./plugins/plugin-chart-pivot-table/src/react-pivottable/utilities.js","webpack://superset/./plugins/plugin-chart-pivot-table/src/react-pivottable/Styles.js","webpack://superset/./plugins/plugin-chart-pivot-table/src/react-pivottable/TableRenderers.jsx","webpack://superset/./plugins/plugin-chart-pivot-table/src/react-pivottable/PivotTable.jsx","webpack://superset/./plugins/plugin-chart-pivot-table/src/PivotTableChart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const getSelectedText = () => window.getSelection()?.toString();\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\n\nimport * as React from 'react';\nimport PlusSquareOutlinedSvg from \"@ant-design/icons-svg/es/asn/PlusSquareOutlined\";\nimport AntdIcon from \"../components/AntdIcon\";\nvar PlusSquareOutlined = function PlusSquareOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _extends({}, props, {\n    ref: ref,\n    icon: PlusSquareOutlinedSvg\n  }));\n};\n\n/**![plus-square](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNjYWNhY2EiIHZpZXdCb3g9IjY0IDY0IDg5NiA4OTYiIGZvY3VzYWJsZT0iZmFsc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTMyOCA1NDRoMTUydjE1MmMwIDQuNCAzLjYgOCA4IDhoNDhjNC40IDAgOC0zLjYgOC04VjU0NGgxNTJjNC40IDAgOC0zLjYgOC04di00OGMwLTQuNC0zLjYtOC04LThINTQ0VjMyOGMwLTQuNC0zLjYtOC04LThoLTQ4Yy00LjQgMC04IDMuNi04IDh2MTUySDMyOGMtNC40IDAtOCAzLjYtOCA4djQ4YzAgNC40IDMuNiA4IDggOHoiIC8+PHBhdGggZD0iTTg4MCAxMTJIMTQ0Yy0xNy43IDAtMzIgMTQuMy0zMiAzMnY3MzZjMCAxNy43IDE0LjMgMzIgMzIgMzJoNzM2YzE3LjcgMCAzMi0xNC4zIDMyLTMyVjE0NGMwLTE3LjctMTQuMy0zMi0zMi0zMnptLTQwIDcyOEgxODRWMTg0aDY1NnY2NTZ6IiAvPjwvc3ZnPg==) */\nvar RefIcon = /*#__PURE__*/React.forwardRef(PlusSquareOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'PlusSquareOutlined';\n}\nexport default RefIcon;","import _extends from \"@babel/runtime/helpers/esm/extends\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\n\nimport * as React from 'react';\nimport MinusSquareOutlinedSvg from \"@ant-design/icons-svg/es/asn/MinusSquareOutlined\";\nimport AntdIcon from \"../components/AntdIcon\";\nvar MinusSquareOutlined = function MinusSquareOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _extends({}, props, {\n    ref: ref,\n    icon: MinusSquareOutlinedSvg\n  }));\n};\n\n/**![minus-square](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNjYWNhY2EiIHZpZXdCb3g9IjY0IDY0IDg5NiA4OTYiIGZvY3VzYWJsZT0iZmFsc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTMyOCA1NDRoMzY4YzQuNCAwIDgtMy42IDgtOHYtNDhjMC00LjQtMy42LTgtOC04SDMyOGMtNC40IDAtOCAzLjYtOCA4djQ4YzAgNC40IDMuNiA4IDggOHoiIC8+PHBhdGggZD0iTTg4MCAxMTJIMTQ0Yy0xNy43IDAtMzIgMTQuMy0zMiAzMnY3MzZjMCAxNy43IDE0LjMgMzIgMzIgMzJoNzM2YzE3LjcgMCAzMi0xNC4zIDMyLTMyVjE0NGMwLTE3LjctMTQuMy0zMi0zMi0zMnptLTQwIDcyOEgxODRWMTg0aDY1NnY2NTZ6IiAvPjwvc3ZnPg==) */\nvar RefIcon = /*#__PURE__*/React.forwardRef(MinusSquareOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'MinusSquareOutlined';\n}\nexport default RefIcon;","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\n\nconst addSeparators = function (nStr, thousandsSep, decimalSep) {\n  const x = String(nStr).split('.');\n  let x1 = x[0];\n  const x2 = x.length > 1 ? decimalSep + x[1] : '';\n  const rgx = /(\\d+)(\\d{3})/;\n  while (rgx.test(x1)) {\n    x1 = x1.replace(rgx, `$1${thousandsSep}$2`);\n  }\n  return x1 + x2;\n};\n\nconst numberFormat = function (optsIn) {\n  const defaults = {\n    digitsAfterDecimal: 2,\n    scaler: 1,\n    thousandsSep: ',',\n    decimalSep: '.',\n    prefix: '',\n    suffix: '',\n  };\n  const opts = { ...defaults, ...optsIn };\n  return function (x) {\n    if (Number.isNaN(x) || !Number.isFinite(x)) {\n      return '';\n    }\n    const result = addSeparators(\n      (opts.scaler * x).toFixed(opts.digitsAfterDecimal),\n      opts.thousandsSep,\n      opts.decimalSep,\n    );\n    return `${opts.prefix}${result}${opts.suffix}`;\n  };\n};\n\nconst rx = /(\\d+)|(\\D+)/g;\nconst rd = /\\d/;\nconst rz = /^0/;\nconst naturalSort = (as, bs) => {\n  // nulls first\n  if (bs !== null && as === null) {\n    return -1;\n  }\n  if (as !== null && bs === null) {\n    return 1;\n  }\n\n  // then raw NaNs\n  if (typeof as === 'number' && Number.isNaN(as)) {\n    return -1;\n  }\n  if (typeof bs === 'number' && Number.isNaN(bs)) {\n    return 1;\n  }\n\n  // numbers and numbery strings group together\n  const nas = Number(as);\n  const nbs = Number(bs);\n  if (nas < nbs) {\n    return -1;\n  }\n  if (nas > nbs) {\n    return 1;\n  }\n\n  // within that, true numbers before numbery strings\n  if (typeof as === 'number' && typeof bs !== 'number') {\n    return -1;\n  }\n  if (typeof bs === 'number' && typeof as !== 'number') {\n    return 1;\n  }\n  if (typeof as === 'number' && typeof bs === 'number') {\n    return 0;\n  }\n\n  // 'Infinity' is a textual number, so less than 'A'\n  if (Number.isNaN(nbs) && !Number.isNaN(nas)) {\n    return -1;\n  }\n  if (Number.isNaN(nas) && !Number.isNaN(nbs)) {\n    return 1;\n  }\n\n  // finally, \"smart\" string sorting per http://stackoverflow.com/a/4373421/112871\n  let a = String(as);\n  let b = String(bs);\n  if (a === b) {\n    return 0;\n  }\n  if (!rd.test(a) || !rd.test(b)) {\n    return a > b ? 1 : -1;\n  }\n\n  // special treatment for strings containing digits\n  a = a.match(rx);\n  b = b.match(rx);\n  while (a.length && b.length) {\n    const a1 = a.shift();\n    const b1 = b.shift();\n    if (a1 !== b1) {\n      if (rd.test(a1) && rd.test(b1)) {\n        return a1.replace(rz, '.0') - b1.replace(rz, '.0');\n      }\n      return a1 > b1 ? 1 : -1;\n    }\n  }\n  return a.length - b.length;\n};\n\nconst sortAs = function (order) {\n  const mapping = {};\n\n  // sort lowercased keys similarly\n  const lMapping = {};\n  order.forEach((element, i) => {\n    mapping[element] = i;\n    if (typeof element === 'string') {\n      lMapping[element.toLowerCase()] = i;\n    }\n  });\n  return function (a, b) {\n    if (a in mapping && b in mapping) {\n      return mapping[a] - mapping[b];\n    }\n    if (a in mapping) {\n      return -1;\n    }\n    if (b in mapping) {\n      return 1;\n    }\n    if (a in lMapping && b in lMapping) {\n      return lMapping[a] - lMapping[b];\n    }\n    if (a in lMapping) {\n      return -1;\n    }\n    if (b in lMapping) {\n      return 1;\n    }\n    return naturalSort(a, b);\n  };\n};\n\nconst getSort = function (sorters, attr) {\n  if (sorters) {\n    if (typeof sorters === 'function') {\n      const sort = sorters(attr);\n      if (typeof sort === 'function') {\n        return sort;\n      }\n    } else if (attr in sorters) {\n      return sorters[attr];\n    }\n  }\n  return naturalSort;\n};\n\n// aggregator templates default to US number formatting but this is overridable\nconst usFmt = numberFormat();\nconst usFmtInt = numberFormat({ digitsAfterDecimal: 0 });\nconst usFmtPct = numberFormat({\n  digitsAfterDecimal: 1,\n  scaler: 100,\n  suffix: '%',\n});\n\nconst fmtNonString = formatter => x =>\n  typeof x === 'string' ? x : formatter(x);\n\nconst baseAggregatorTemplates = {\n  count(formatter = usFmtInt) {\n    return () =>\n      function () {\n        return {\n          count: 0,\n          push() {\n            this.count += 1;\n          },\n          value() {\n            return this.count;\n          },\n          format: formatter,\n        };\n      };\n  },\n\n  uniques(fn, formatter = usFmtInt) {\n    return function ([attr]) {\n      return function () {\n        return {\n          uniq: [],\n          push(record) {\n            if (!Array.from(this.uniq).includes(record[attr])) {\n              this.uniq.push(record[attr]);\n            }\n          },\n          value() {\n            return fn(this.uniq);\n          },\n          format: fmtNonString(formatter),\n          numInputs: typeof attr !== 'undefined' ? 0 : 1,\n        };\n      };\n    };\n  },\n\n  sum(formatter = usFmt) {\n    return function ([attr]) {\n      return function () {\n        return {\n          sum: 0,\n          push(record) {\n            if (Number.isNaN(Number(record[attr]))) {\n              this.sum = record[attr];\n            } else {\n              this.sum += parseFloat(record[attr]);\n            }\n          },\n          value() {\n            return this.sum;\n          },\n          format: fmtNonString(formatter),\n          numInputs: typeof attr !== 'undefined' ? 0 : 1,\n        };\n      };\n    };\n  },\n\n  extremes(mode, formatter = usFmt) {\n    return function ([attr]) {\n      return function (data) {\n        return {\n          val: null,\n          sorter: getSort(\n            typeof data !== 'undefined' ? data.sorters : null,\n            attr,\n          ),\n          push(record) {\n            const x = record[attr];\n            if (['min', 'max'].includes(mode)) {\n              const coercedValue = Number(x);\n              if (Number.isNaN(coercedValue)) {\n                this.val =\n                  !this.val ||\n                  (mode === 'min' && x < this.val) ||\n                  (mode === 'max' && x > this.val)\n                    ? x\n                    : this.val;\n              } else {\n                this.val = Math[mode](\n                  coercedValue,\n                  this.val !== null ? this.val : coercedValue,\n                );\n              }\n            } else if (\n              mode === 'first' &&\n              this.sorter(x, this.val !== null ? this.val : x) <= 0\n            ) {\n              this.val = x;\n            } else if (\n              mode === 'last' &&\n              this.sorter(x, this.val !== null ? this.val : x) >= 0\n            ) {\n              this.val = x;\n            }\n          },\n          value() {\n            return this.val;\n          },\n          format(x) {\n            if (typeof x === 'number') {\n              return formatter(x);\n            }\n            return x;\n          },\n          numInputs: typeof attr !== 'undefined' ? 0 : 1,\n        };\n      };\n    };\n  },\n\n  quantile(q, formatter = usFmt) {\n    return function ([attr]) {\n      return function () {\n        return {\n          vals: [],\n          strMap: {},\n          push(record) {\n            const val = record[attr];\n            const x = Number(val);\n\n            if (Number.isNaN(x)) {\n              this.strMap[val] = (this.strMap[val] || 0) + 1;\n            } else {\n              this.vals.push(x);\n            }\n          },\n          value() {\n            if (\n              this.vals.length === 0 &&\n              Object.keys(this.strMap).length === 0\n            ) {\n              return null;\n            }\n\n            if (Object.keys(this.strMap).length) {\n              const values = Object.values(this.strMap).sort((a, b) => a - b);\n              const middle = Math.floor(values.length / 2);\n\n              const keys = Object.keys(this.strMap);\n              return keys.length % 2 !== 0\n                ? keys[middle]\n                : (keys[middle - 1] + keys[middle]) / 2;\n            }\n\n            this.vals.sort((a, b) => a - b);\n            const i = (this.vals.length - 1) * q;\n            return (this.vals[Math.floor(i)] + this.vals[Math.ceil(i)]) / 2.0;\n          },\n          format: fmtNonString(formatter),\n          numInputs: typeof attr !== 'undefined' ? 0 : 1,\n        };\n      };\n    };\n  },\n\n  runningStat(mode = 'mean', ddof = 1, formatter = usFmt) {\n    return function ([attr]) {\n      return function () {\n        return {\n          n: 0.0,\n          m: 0.0,\n          s: 0.0,\n          strValue: null,\n          push(record) {\n            const x = Number(record[attr]);\n            if (Number.isNaN(x)) {\n              this.strValue =\n                typeof record[attr] === 'string' ? record[attr] : this.strValue;\n              return;\n            }\n            this.n += 1.0;\n            if (this.n === 1.0) {\n              this.m = x;\n            }\n            const mNew = this.m + (x - this.m) / this.n;\n            this.s += (x - this.m) * (x - mNew);\n            this.m = mNew;\n          },\n          value() {\n            if (this.strValue) {\n              return this.strValue;\n            }\n\n            if (mode === 'mean') {\n              if (this.n === 0) {\n                return 0 / 0;\n              }\n              return this.m;\n            }\n            if (this.n <= ddof) {\n              return 0;\n            }\n            switch (mode) {\n              case 'var':\n                return this.s / (this.n - ddof);\n              case 'stdev':\n                return Math.sqrt(this.s / (this.n - ddof));\n              default:\n                throw new Error('unknown mode for runningStat');\n            }\n          },\n          format: fmtNonString(formatter),\n          numInputs: typeof attr !== 'undefined' ? 0 : 1,\n        };\n      };\n    };\n  },\n\n  sumOverSum(formatter = usFmt) {\n    return function ([num, denom]) {\n      return function () {\n        return {\n          sumNum: 0,\n          sumDenom: 0,\n          push(record) {\n            if (!Number.isNaN(Number(record[num]))) {\n              this.sumNum += parseFloat(record[num]);\n            }\n            if (!Number.isNaN(Number(record[denom]))) {\n              this.sumDenom += parseFloat(record[denom]);\n            }\n          },\n          value() {\n            return this.sumNum / this.sumDenom;\n          },\n          format: formatter,\n          numInputs:\n            typeof num !== 'undefined' && typeof denom !== 'undefined' ? 0 : 2,\n        };\n      };\n    };\n  },\n\n  fractionOf(wrapped, type = 'total', formatter = usFmtPct) {\n    return (...x) =>\n      function (data, rowKey, colKey) {\n        return {\n          selector: { total: [[], []], row: [rowKey, []], col: [[], colKey] }[\n            type\n          ],\n          inner: wrapped(...Array.from(x || []))(data, rowKey, colKey),\n          push(record) {\n            this.inner.push(record);\n          },\n          format: fmtNonString(formatter),\n          value() {\n            const acc = data\n              .getAggregator(...Array.from(this.selector || []))\n              .inner.value();\n\n            if (typeof acc === 'string') {\n              return acc;\n            }\n\n            return this.inner.value() / acc;\n          },\n          numInputs: wrapped(...Array.from(x || []))().numInputs,\n        };\n      };\n  },\n};\n\nconst extendedAggregatorTemplates = {\n  countUnique(f) {\n    return baseAggregatorTemplates.uniques(x => x.length, f);\n  },\n  listUnique(s, f) {\n    return baseAggregatorTemplates.uniques(x => x.join(s), f || (x => x));\n  },\n  max(f) {\n    return baseAggregatorTemplates.extremes('max', f);\n  },\n  min(f) {\n    return baseAggregatorTemplates.extremes('min', f);\n  },\n  first(f) {\n    return baseAggregatorTemplates.extremes('first', f);\n  },\n  last(f) {\n    return baseAggregatorTemplates.extremes('last', f);\n  },\n  median(f) {\n    return baseAggregatorTemplates.quantile(0.5, f);\n  },\n  average(f) {\n    return baseAggregatorTemplates.runningStat('mean', 1, f);\n  },\n  var(ddof, f) {\n    return baseAggregatorTemplates.runningStat('var', ddof, f);\n  },\n  stdev(ddof, f) {\n    return baseAggregatorTemplates.runningStat('stdev', ddof, f);\n  },\n};\n\nconst aggregatorTemplates = {\n  ...baseAggregatorTemplates,\n  ...extendedAggregatorTemplates,\n};\n\n// default aggregators & renderers use US naming and number formatting\nconst aggregators = (tpl => ({\n  Count: tpl.count(usFmtInt),\n  'Count Unique Values': tpl.countUnique(usFmtInt),\n  'List Unique Values': tpl.listUnique(', '),\n  Sum: tpl.sum(usFmt),\n  'Integer Sum': tpl.sum(usFmtInt),\n  Average: tpl.average(usFmt),\n  Median: tpl.median(usFmt),\n  'Sample Variance': tpl.var(1, usFmt),\n  'Sample Standard Deviation': tpl.stdev(1, usFmt),\n  Minimum: tpl.min(usFmt),\n  Maximum: tpl.max(usFmt),\n  First: tpl.first(usFmt),\n  Last: tpl.last(usFmt),\n  'Sum over Sum': tpl.sumOverSum(usFmt),\n  'Sum as Fraction of Total': tpl.fractionOf(tpl.sum(), 'total', usFmtPct),\n  'Sum as Fraction of Rows': tpl.fractionOf(tpl.sum(), 'row', usFmtPct),\n  'Sum as Fraction of Columns': tpl.fractionOf(tpl.sum(), 'col', usFmtPct),\n  'Count as Fraction of Total': tpl.fractionOf(tpl.count(), 'total', usFmtPct),\n  'Count as Fraction of Rows': tpl.fractionOf(tpl.count(), 'row', usFmtPct),\n  'Count as Fraction of Columns': tpl.fractionOf(tpl.count(), 'col', usFmtPct),\n}))(aggregatorTemplates);\n\nconst locales = {\n  en: {\n    aggregators,\n    localeStrings: {\n      renderError: 'An error occurred rendering the PivotTable results.',\n      computeError: 'An error occurred computing the PivotTable results.',\n      uiRenderError: 'An error occurred rendering the PivotTable UI.',\n      selectAll: 'Select All',\n      selectNone: 'Select None',\n      tooMany: '(too many to list)',\n      filterResults: 'Filter values',\n      apply: 'Apply',\n      cancel: 'Cancel',\n      totals: 'Totals',\n      vs: 'vs',\n      by: 'by',\n    },\n  },\n};\n\n// dateFormat deriver l10n requires month and day names to be passed in directly\nconst mthNamesEn = [\n  'Jan',\n  'Feb',\n  'Mar',\n  'Apr',\n  'May',\n  'Jun',\n  'Jul',\n  'Aug',\n  'Sep',\n  'Oct',\n  'Nov',\n  'Dec',\n];\nconst dayNamesEn = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\nconst zeroPad = number => `0${number}`.substr(-2, 2); // eslint-disable-line no-magic-numbers\n\nconst derivers = {\n  bin(col, binWidth) {\n    return record => record[col] - (record[col] % binWidth);\n  },\n  dateFormat(\n    col,\n    formatString,\n    utcOutput = false,\n    mthNames = mthNamesEn,\n    dayNames = dayNamesEn,\n  ) {\n    const utc = utcOutput ? 'UTC' : '';\n    return function (record) {\n      const date = new Date(Date.parse(record[col]));\n      if (Number.isNaN(date)) {\n        return '';\n      }\n      return formatString.replace(/%(.)/g, function (m, p) {\n        switch (p) {\n          case 'y':\n            return date[`get${utc}FullYear`]();\n          case 'm':\n            return zeroPad(date[`get${utc}Month`]() + 1);\n          case 'n':\n            return mthNames[date[`get${utc}Month`]()];\n          case 'd':\n            return zeroPad(date[`get${utc}Date`]());\n          case 'w':\n            return dayNames[date[`get${utc}Day`]()];\n          case 'x':\n            return date[`get${utc}Day`]();\n          case 'H':\n            return zeroPad(date[`get${utc}Hours`]());\n          case 'M':\n            return zeroPad(date[`get${utc}Minutes`]());\n          case 'S':\n            return zeroPad(date[`get${utc}Seconds`]());\n          default:\n            return `%${p}`;\n        }\n      });\n    };\n  },\n};\n\n// Given an array of attribute values, convert to a key that\n// can be used in objects.\nconst flatKey = attrVals => attrVals.join(String.fromCharCode(0));\n\n/*\nData Model class\n*/\n\nclass PivotData {\n  constructor(inputProps = {}, subtotals = {}) {\n    this.props = { ...PivotData.defaultProps, ...inputProps };\n    this.processRecord = this.processRecord.bind(this);\n    PropTypes.checkPropTypes(\n      PivotData.propTypes,\n      this.props,\n      'prop',\n      'PivotData',\n    );\n\n    this.aggregator = this.props\n      .aggregatorsFactory(this.props.defaultFormatter)\n      [this.props.aggregatorName](this.props.vals);\n    this.formattedAggregators =\n      this.props.customFormatters &&\n      Object.entries(this.props.customFormatters).reduce(\n        (acc, [key, columnFormatter]) => {\n          acc[key] = {};\n          Object.entries(columnFormatter).forEach(([column, formatter]) => {\n            acc[key][column] = this.props\n              .aggregatorsFactory(formatter)\n              [this.props.aggregatorName](this.props.vals);\n          });\n          return acc;\n        },\n        {},\n      );\n    this.tree = {};\n    this.rowKeys = [];\n    this.colKeys = [];\n    this.rowTotals = {};\n    this.colTotals = {};\n    this.allTotal = this.aggregator(this, [], []);\n    this.subtotals = subtotals;\n    this.sorted = false;\n\n    // iterate through input, accumulating data for cells\n    PivotData.forEachRecord(this.props.data, this.processRecord);\n  }\n\n  getFormattedAggregator(record, totalsKeys) {\n    if (!this.formattedAggregators) {\n      return this.aggregator;\n    }\n    const [groupName, groupValue] =\n      Object.entries(record).find(\n        ([name, value]) =>\n          this.formattedAggregators[name] &&\n          this.formattedAggregators[name][value],\n      ) || [];\n    if (\n      !groupName ||\n      !groupValue ||\n      (totalsKeys && !totalsKeys.includes(groupValue))\n    ) {\n      return this.aggregator;\n    }\n    return this.formattedAggregators[groupName][groupValue] || this.aggregator;\n  }\n\n  arrSort(attrs, partialOnTop, reverse = false) {\n    const sortersArr = attrs.map(a => getSort(this.props.sorters, a));\n    return function (a, b) {\n      const limit = Math.min(a.length, b.length);\n      for (let i = 0; i < limit; i += 1) {\n        const sorter = sortersArr[i];\n        const comparison = reverse ? sorter(b[i], a[i]) : sorter(a[i], b[i]);\n        if (comparison !== 0) {\n          return comparison;\n        }\n      }\n      return partialOnTop ? a.length - b.length : b.length - a.length;\n    };\n  }\n\n  sortKeys() {\n    if (!this.sorted) {\n      this.sorted = true;\n      const v = (r, c) => this.getAggregator(r, c).value();\n      switch (this.props.rowOrder) {\n        case 'key_z_to_a':\n          this.rowKeys.sort(\n            this.arrSort(this.props.rows, this.subtotals.rowPartialOnTop, true),\n          );\n          break;\n        case 'value_a_to_z':\n          this.rowKeys.sort((a, b) => naturalSort(v(a, []), v(b, [])));\n          break;\n        case 'value_z_to_a':\n          this.rowKeys.sort((a, b) => -naturalSort(v(a, []), v(b, [])));\n          break;\n        default:\n          this.rowKeys.sort(\n            this.arrSort(this.props.rows, this.subtotals.rowPartialOnTop),\n          );\n      }\n      switch (this.props.colOrder) {\n        case 'key_z_to_a':\n          this.colKeys.sort(\n            this.arrSort(this.props.cols, this.subtotals.colPartialOnTop, true),\n          );\n          break;\n        case 'value_a_to_z':\n          this.colKeys.sort((a, b) => naturalSort(v([], a), v([], b)));\n          break;\n        case 'value_z_to_a':\n          this.colKeys.sort((a, b) => -naturalSort(v([], a), v([], b)));\n          break;\n        default:\n          this.colKeys.sort(\n            this.arrSort(this.props.cols, this.subtotals.colPartialOnTop),\n          );\n      }\n    }\n  }\n\n  getColKeys() {\n    this.sortKeys();\n    return this.colKeys;\n  }\n\n  getRowKeys() {\n    this.sortKeys();\n    return this.rowKeys;\n  }\n\n  processRecord(record) {\n    // this code is called in a tight loop\n    const colKey = [];\n    const rowKey = [];\n    this.props.cols.forEach(col => {\n      colKey.push(col in record ? record[col] : 'null');\n    });\n    this.props.rows.forEach(row => {\n      rowKey.push(row in record ? record[row] : 'null');\n    });\n\n    this.allTotal.push(record);\n\n    const rowStart = this.subtotals.rowEnabled ? 1 : Math.max(1, rowKey.length);\n    const colStart = this.subtotals.colEnabled ? 1 : Math.max(1, colKey.length);\n\n    let isRowSubtotal;\n    let isColSubtotal;\n    for (let ri = rowStart; ri <= rowKey.length; ri += 1) {\n      isRowSubtotal = ri < rowKey.length;\n      const fRowKey = rowKey.slice(0, ri);\n      const flatRowKey = flatKey(fRowKey);\n      if (!this.rowTotals[flatRowKey]) {\n        this.rowKeys.push(fRowKey);\n        this.rowTotals[flatRowKey] = this.getFormattedAggregator(\n          record,\n          rowKey,\n        )(this, fRowKey, []);\n      }\n      this.rowTotals[flatRowKey].push(record);\n      this.rowTotals[flatRowKey].isSubtotal = isRowSubtotal;\n    }\n\n    for (let ci = colStart; ci <= colKey.length; ci += 1) {\n      isColSubtotal = ci < colKey.length;\n      const fColKey = colKey.slice(0, ci);\n      const flatColKey = flatKey(fColKey);\n      if (!this.colTotals[flatColKey]) {\n        this.colKeys.push(fColKey);\n        this.colTotals[flatColKey] = this.getFormattedAggregator(\n          record,\n          colKey,\n        )(this, [], fColKey);\n      }\n      this.colTotals[flatColKey].push(record);\n      this.colTotals[flatColKey].isSubtotal = isColSubtotal;\n    }\n\n    // And now fill in for all the sub-cells.\n    for (let ri = rowStart; ri <= rowKey.length; ri += 1) {\n      isRowSubtotal = ri < rowKey.length;\n      const fRowKey = rowKey.slice(0, ri);\n      const flatRowKey = flatKey(fRowKey);\n      if (!this.tree[flatRowKey]) {\n        this.tree[flatRowKey] = {};\n      }\n      for (let ci = colStart; ci <= colKey.length; ci += 1) {\n        isColSubtotal = ci < colKey.length;\n        const fColKey = colKey.slice(0, ci);\n        const flatColKey = flatKey(fColKey);\n        if (!this.tree[flatRowKey][flatColKey]) {\n          this.tree[flatRowKey][flatColKey] = this.getFormattedAggregator(\n            record,\n          )(this, fRowKey, fColKey);\n        }\n        this.tree[flatRowKey][flatColKey].push(record);\n\n        this.tree[flatRowKey][flatColKey].isRowSubtotal = isRowSubtotal;\n        this.tree[flatRowKey][flatColKey].isColSubtotal = isColSubtotal;\n        this.tree[flatRowKey][flatColKey].isSubtotal =\n          isRowSubtotal || isColSubtotal;\n      }\n    }\n  }\n\n  getAggregator(rowKey, colKey) {\n    let agg;\n    const flatRowKey = flatKey(rowKey);\n    const flatColKey = flatKey(colKey);\n    if (rowKey.length === 0 && colKey.length === 0) {\n      agg = this.allTotal;\n    } else if (rowKey.length === 0) {\n      agg = this.colTotals[flatColKey];\n    } else if (colKey.length === 0) {\n      agg = this.rowTotals[flatRowKey];\n    } else {\n      agg = this.tree[flatRowKey][flatColKey];\n    }\n    return (\n      agg || {\n        value() {\n          return null;\n        },\n        format() {\n          return '';\n        },\n      }\n    );\n  }\n}\n\n// can handle arrays or jQuery selections of tables\nPivotData.forEachRecord = function (input, processRecord) {\n  if (Array.isArray(input)) {\n    // array of objects\n    return input.map(record => processRecord(record));\n  }\n  throw new Error(t('Unknown input format'));\n};\n\nPivotData.defaultProps = {\n  aggregators,\n  cols: [],\n  rows: [],\n  vals: [],\n  aggregatorName: 'Count',\n  sorters: {},\n  rowOrder: 'key_a_to_z',\n  colOrder: 'key_a_to_z',\n};\n\nPivotData.propTypes = {\n  data: PropTypes.oneOfType([PropTypes.array, PropTypes.object, PropTypes.func])\n    .isRequired,\n  aggregatorName: PropTypes.string,\n  cols: PropTypes.arrayOf(PropTypes.string),\n  rows: PropTypes.arrayOf(PropTypes.string),\n  vals: PropTypes.arrayOf(PropTypes.string),\n  valueFilter: PropTypes.objectOf(PropTypes.objectOf(PropTypes.bool)),\n  sorters: PropTypes.oneOfType([\n    PropTypes.func,\n    PropTypes.objectOf(PropTypes.func),\n  ]),\n  derivedAttributes: PropTypes.objectOf(PropTypes.func),\n  rowOrder: PropTypes.oneOf([\n    'key_a_to_z',\n    'key_z_to_a',\n    'value_a_to_z',\n    'value_z_to_a',\n  ]),\n  colOrder: PropTypes.oneOf([\n    'key_a_to_z',\n    'key_z_to_a',\n    'value_a_to_z',\n    'value_z_to_a',\n  ]),\n};\n\nexport {\n  aggregatorTemplates,\n  aggregators,\n  derivers,\n  locales,\n  naturalSort,\n  numberFormat,\n  getSort,\n  sortAs,\n  flatKey,\n  PivotData,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { css, styled } from '@superset-ui/core';\n\nexport const Styles = styled.div`\n  ${({ theme, isDashboardEditMode }) => css`\n    table.pvtTable {\n      position: ${isDashboardEditMode ? 'inherit' : 'relative'};\n      width: calc(100% - ${theme.gridUnit}px);\n      font-size: ${theme.typography.sizes.s}px;\n      text-align: left;\n      margin: ${theme.gridUnit}px;\n      border-collapse: separate;\n      font-family: ${theme.typography.families.sansSerif};\n      line-height: 1.4;\n    }\n\n    table thead {\n      position: ${isDashboardEditMode ? 'inherit' : 'sticky'};\n      top: 0;\n    }\n\n    table tbody tr {\n      font-feature-settings: 'tnum' 1;\n    }\n\n    table.pvtTable thead tr th,\n    table.pvtTable tbody tr th {\n      background-color: ${theme.colors.grayscale.light5};\n      border-top: 1px solid ${theme.colors.grayscale.light2};\n      border-left: 1px solid ${theme.colors.grayscale.light2};\n      font-size: ${theme.typography.sizes.s}px;\n      padding: ${theme.gridUnit}px;\n      font-weight: ${theme.typography.weights.normal};\n    }\n\n    table.pvtTable tbody tr.pvtRowTotals {\n      position: ${isDashboardEditMode ? 'inherit' : 'sticky'};\n      bottom: 0;\n    }\n\n    table.pvtTable thead tr:last-of-type th,\n    table.pvtTable thead tr:first-of-type th.pvtTotalLabel,\n    table.pvtTable thead tr:nth-last-of-type(2) th.pvtColLabel,\n    table.pvtTable thead th.pvtSubtotalLabel,\n    table.pvtTable tbody tr:last-of-type th,\n    table.pvtTable tbody tr:last-of-type td {\n      border-bottom: 1px solid ${theme.colors.grayscale.light2};\n    }\n\n    table.pvtTable\n      thead\n      tr:last-of-type:not(:only-child)\n      th.pvtAxisLabel\n      ~ th.pvtColLabel,\n    table.pvtTable tbody tr:first-of-type th,\n    table.pvtTable tbody tr:first-of-type td {\n      border-top: none;\n    }\n\n    table.pvtTable tbody tr td:last-of-type,\n    table.pvtTable thead tr th:last-of-type:not(.pvtSubtotalLabel) {\n      border-right: 1px solid ${theme.colors.grayscale.light2};\n    }\n\n    table.pvtTable\n      thead\n      tr:last-of-type:not(:only-child)\n      th.pvtAxisLabel\n      + .pvtTotalLabel {\n      border-right: none;\n    }\n\n    table.pvtTable tr th.active {\n      background-color: ${theme.colors.primary.light3};\n    }\n\n    table.pvtTable .pvtTotalLabel {\n      text-align: right;\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    table.pvtTable .pvtSubtotalLabel {\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    table.pvtTable tbody tr td {\n      color: ${theme.colors.primary.dark2};\n      padding: ${theme.gridUnit}px;\n      background-color: ${theme.colors.grayscale.light5};\n      border-top: 1px solid ${theme.colors.grayscale.light2};\n      border-left: 1px solid ${theme.colors.grayscale.light2};\n      vertical-align: top;\n      text-align: right;\n    }\n\n    table.pvtTable tbody tr th.pvtRowLabel {\n      vertical-align: baseline;\n    }\n\n    .pvtTotal,\n    .pvtGrandTotal {\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    table.pvtTable tbody tr td.pvtRowTotal {\n      vertical-align: middle;\n    }\n\n    .toggle-wrapper {\n      white-space: nowrap;\n    }\n\n    .toggle-wrapper > .toggle-val {\n      white-space: normal;\n    }\n\n    .toggle {\n      padding-right: ${theme.gridUnit}px;\n      cursor: pointer;\n    }\n\n    .hoverable:hover {\n      background-color: ${theme.colors.primary.light4};\n      cursor: pointer;\n    }\n  `}\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Component } from 'react';\nimport { t, safeHtmlSpan } from '@superset-ui/core';\nimport PropTypes from 'prop-types';\nimport { PivotData, flatKey } from './utilities';\nimport { Styles } from './Styles';\n\nconst parseLabel = value => {\n  if (typeof value === 'string') {\n    if (value === 'metric') return t('metric');\n    return value;\n  }\n  if (typeof value === 'number') {\n    return value;\n  }\n  return String(value);\n};\n\nfunction displayHeaderCell(\n  needToggle,\n  ArrowIcon,\n  onArrowClick,\n  value,\n  namesMapping,\n  allowRenderHtml,\n) {\n  const name = namesMapping[value] || value;\n  const parsedLabel = parseLabel(name);\n  const labelContent =\n    allowRenderHtml && typeof parsedLabel === 'string'\n      ? safeHtmlSpan(parsedLabel)\n      : parsedLabel;\n  return needToggle ? (\n    <span className=\"toggle-wrapper\">\n      <span\n        role=\"button\"\n        tabIndex=\"0\"\n        className=\"toggle\"\n        onClick={onArrowClick}\n      >\n        {ArrowIcon}\n      </span>\n      <span className=\"toggle-val\">{labelContent}</span>\n    </span>\n  ) : (\n    labelContent\n  );\n}\n\nexport class TableRenderer extends Component {\n  constructor(props) {\n    super(props);\n\n    // We need state to record which entries are collapsed and which aren't.\n    // This is an object with flat-keys indicating if the corresponding rows\n    // should be collapsed.\n    this.state = { collapsedRows: {}, collapsedCols: {} };\n\n    this.clickHeaderHandler = this.clickHeaderHandler.bind(this);\n    this.clickHandler = this.clickHandler.bind(this);\n  }\n\n  getBasePivotSettings() {\n    // One-time extraction of pivot settings that we'll use throughout the render.\n\n    const { props } = this;\n    const colAttrs = props.cols;\n    const rowAttrs = props.rows;\n\n    const tableOptions = {\n      rowTotals: true,\n      colTotals: true,\n      ...props.tableOptions,\n    };\n    const rowTotals = tableOptions.rowTotals || colAttrs.length === 0;\n    const colTotals = tableOptions.colTotals || rowAttrs.length === 0;\n\n    const namesMapping = props.namesMapping || {};\n    const subtotalOptions = {\n      arrowCollapsed: '\\u25B2',\n      arrowExpanded: '\\u25BC',\n      ...props.subtotalOptions,\n    };\n\n    const colSubtotalDisplay = {\n      displayOnTop: false,\n      enabled: tableOptions.colSubTotals,\n      hideOnExpand: false,\n      ...subtotalOptions.colSubtotalDisplay,\n    };\n\n    const rowSubtotalDisplay = {\n      displayOnTop: false,\n      enabled: tableOptions.rowSubTotals,\n      hideOnExpand: false,\n      ...subtotalOptions.rowSubtotalDisplay,\n    };\n\n    const pivotData = new PivotData(props, {\n      rowEnabled: rowSubtotalDisplay.enabled,\n      colEnabled: colSubtotalDisplay.enabled,\n      rowPartialOnTop: rowSubtotalDisplay.displayOnTop,\n      colPartialOnTop: colSubtotalDisplay.displayOnTop,\n    });\n    const rowKeys = pivotData.getRowKeys();\n    const colKeys = pivotData.getColKeys();\n\n    // Also pre-calculate all the callbacks for cells, etc... This is nice to have to\n    // avoid re-calculations of the call-backs on cell expansions, etc...\n    const cellCallbacks = {};\n    const rowTotalCallbacks = {};\n    const colTotalCallbacks = {};\n    let grandTotalCallback = null;\n    if (tableOptions.clickCallback) {\n      rowKeys.forEach(rowKey => {\n        const flatRowKey = flatKey(rowKey);\n        if (!(flatRowKey in cellCallbacks)) {\n          cellCallbacks[flatRowKey] = {};\n        }\n        colKeys.forEach(colKey => {\n          cellCallbacks[flatRowKey][flatKey(colKey)] = this.clickHandler(\n            pivotData,\n            rowKey,\n            colKey,\n          );\n        });\n      });\n\n      // Add in totals as well.\n      if (rowTotals) {\n        rowKeys.forEach(rowKey => {\n          rowTotalCallbacks[flatKey(rowKey)] = this.clickHandler(\n            pivotData,\n            rowKey,\n            [],\n          );\n        });\n      }\n      if (colTotals) {\n        colKeys.forEach(colKey => {\n          colTotalCallbacks[flatKey(colKey)] = this.clickHandler(\n            pivotData,\n            [],\n            colKey,\n          );\n        });\n      }\n      if (rowTotals && colTotals) {\n        grandTotalCallback = this.clickHandler(pivotData, [], []);\n      }\n    }\n\n    return {\n      pivotData,\n      colAttrs,\n      rowAttrs,\n      colKeys,\n      rowKeys,\n      rowTotals,\n      colTotals,\n      arrowCollapsed: subtotalOptions.arrowCollapsed,\n      arrowExpanded: subtotalOptions.arrowExpanded,\n      colSubtotalDisplay,\n      rowSubtotalDisplay,\n      cellCallbacks,\n      rowTotalCallbacks,\n      colTotalCallbacks,\n      grandTotalCallback,\n      namesMapping,\n      allowRenderHtml: props.allowRenderHtml,\n    };\n  }\n\n  clickHandler(pivotData, rowValues, colValues) {\n    const colAttrs = this.props.cols;\n    const rowAttrs = this.props.rows;\n    const value = pivotData.getAggregator(rowValues, colValues).value();\n    const filters = {};\n    const colLimit = Math.min(colAttrs.length, colValues.length);\n    for (let i = 0; i < colLimit; i += 1) {\n      const attr = colAttrs[i];\n      if (colValues[i] !== null) {\n        filters[attr] = colValues[i];\n      }\n    }\n    const rowLimit = Math.min(rowAttrs.length, rowValues.length);\n    for (let i = 0; i < rowLimit; i += 1) {\n      const attr = rowAttrs[i];\n      if (rowValues[i] !== null) {\n        filters[attr] = rowValues[i];\n      }\n    }\n    return e =>\n      this.props.tableOptions.clickCallback(e, value, filters, pivotData);\n  }\n\n  clickHeaderHandler(\n    pivotData,\n    values,\n    attrs,\n    attrIdx,\n    callback,\n    isSubtotal = false,\n    isGrandTotal = false,\n  ) {\n    const filters = {};\n    for (let i = 0; i <= attrIdx; i += 1) {\n      const attr = attrs[i];\n      filters[attr] = values[i];\n    }\n    return e =>\n      callback(\n        e,\n        values[attrIdx],\n        filters,\n        pivotData,\n        isSubtotal,\n        isGrandTotal,\n      );\n  }\n\n  collapseAttr(rowOrCol, attrIdx, allKeys) {\n    return e => {\n      // Collapse an entire attribute.\n      e.stopPropagation();\n      const keyLen = attrIdx + 1;\n      const collapsed = allKeys.filter(k => k.length === keyLen).map(flatKey);\n\n      const updates = {};\n      collapsed.forEach(k => {\n        updates[k] = true;\n      });\n\n      if (rowOrCol) {\n        this.setState(state => ({\n          collapsedRows: { ...state.collapsedRows, ...updates },\n        }));\n      } else {\n        this.setState(state => ({\n          collapsedCols: { ...state.collapsedCols, ...updates },\n        }));\n      }\n    };\n  }\n\n  expandAttr(rowOrCol, attrIdx, allKeys) {\n    return e => {\n      // Expand an entire attribute. This implicitly implies expanding all of the\n      // parents as well. It's a bit inefficient but ah well...\n      e.stopPropagation();\n      const updates = {};\n      allKeys.forEach(k => {\n        for (let i = 0; i <= attrIdx; i += 1) {\n          updates[flatKey(k.slice(0, i + 1))] = false;\n        }\n      });\n\n      if (rowOrCol) {\n        this.setState(state => ({\n          collapsedRows: { ...state.collapsedRows, ...updates },\n        }));\n      } else {\n        this.setState(state => ({\n          collapsedCols: { ...state.collapsedCols, ...updates },\n        }));\n      }\n    };\n  }\n\n  toggleRowKey(flatRowKey) {\n    return e => {\n      e.stopPropagation();\n      this.setState(state => ({\n        collapsedRows: {\n          ...state.collapsedRows,\n          [flatRowKey]: !state.collapsedRows[flatRowKey],\n        },\n      }));\n    };\n  }\n\n  toggleColKey(flatColKey) {\n    return e => {\n      e.stopPropagation();\n      this.setState(state => ({\n        collapsedCols: {\n          ...state.collapsedCols,\n          [flatColKey]: !state.collapsedCols[flatColKey],\n        },\n      }));\n    };\n  }\n\n  calcAttrSpans(attrArr, numAttrs) {\n    // Given an array of attribute values (i.e. each element is another array with\n    // the value at every level), compute the spans for every attribute value at\n    // every level. The return value is a nested array of the same shape. It has\n    // -1's for repeated values and the span number otherwise.\n\n    const spans = [];\n    // Index of the last new value\n    const li = Array(numAttrs).map(() => 0);\n    let lv = Array(numAttrs).map(() => null);\n    for (let i = 0; i < attrArr.length; i += 1) {\n      // Keep increasing span values as long as the last keys are the same. For\n      // the rest, record spans of 1. Update the indices too.\n      const cv = attrArr[i];\n      const ent = [];\n      let depth = 0;\n      const limit = Math.min(lv.length, cv.length);\n      while (depth < limit && lv[depth] === cv[depth]) {\n        ent.push(-1);\n        spans[li[depth]][depth] += 1;\n        depth += 1;\n      }\n      while (depth < cv.length) {\n        li[depth] = i;\n        ent.push(1);\n        depth += 1;\n      }\n      spans.push(ent);\n      lv = cv;\n    }\n    return spans;\n  }\n\n  renderColHeaderRow(attrName, attrIdx, pivotSettings) {\n    // Render a single row in the column header at the top of the pivot table.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      colKeys,\n      visibleColKeys,\n      colAttrSpans,\n      rowTotals,\n      arrowExpanded,\n      arrowCollapsed,\n      colSubtotalDisplay,\n      maxColVisible,\n      pivotData,\n      namesMapping,\n      allowRenderHtml,\n    } = pivotSettings;\n    const {\n      highlightHeaderCellsOnHover,\n      omittedHighlightHeaderGroups = [],\n      highlightedHeaderCells,\n      dateFormatters,\n    } = this.props.tableOptions;\n\n    const spaceCell =\n      attrIdx === 0 && rowAttrs.length !== 0 ? (\n        <th\n          key=\"padding\"\n          colSpan={rowAttrs.length}\n          rowSpan={colAttrs.length}\n          aria-hidden=\"true\"\n        />\n      ) : null;\n\n    const needToggle =\n      colSubtotalDisplay.enabled && attrIdx !== colAttrs.length - 1;\n    let arrowClickHandle = null;\n    let subArrow = null;\n    if (needToggle) {\n      arrowClickHandle =\n        attrIdx + 1 < maxColVisible\n          ? this.collapseAttr(false, attrIdx, colKeys)\n          : this.expandAttr(false, attrIdx, colKeys);\n      subArrow = attrIdx + 1 < maxColVisible ? arrowExpanded : arrowCollapsed;\n    }\n    const attrNameCell = (\n      <th key=\"label\" className=\"pvtAxisLabel\">\n        {displayHeaderCell(\n          needToggle,\n          subArrow,\n          arrowClickHandle,\n          attrName,\n          namesMapping,\n          allowRenderHtml,\n        )}\n      </th>\n    );\n\n    const attrValueCells = [];\n    const rowIncrSpan = rowAttrs.length !== 0 ? 1 : 0;\n    // Iterate through columns. Jump over duplicate values.\n    let i = 0;\n    while (i < visibleColKeys.length) {\n      let handleContextMenu;\n      const colKey = visibleColKeys[i];\n      const colSpan = attrIdx < colKey.length ? colAttrSpans[i][attrIdx] : 1;\n      let colLabelClass = 'pvtColLabel';\n      if (attrIdx < colKey.length) {\n        if (!omittedHighlightHeaderGroups.includes(colAttrs[attrIdx])) {\n          if (highlightHeaderCellsOnHover) {\n            colLabelClass += ' hoverable';\n          }\n          handleContextMenu = e =>\n            this.props.onContextMenu(e, colKey, undefined, {\n              [attrName]: colKey[attrIdx],\n            });\n        }\n        if (\n          highlightedHeaderCells &&\n          Array.isArray(highlightedHeaderCells[colAttrs[attrIdx]]) &&\n          highlightedHeaderCells[colAttrs[attrIdx]].includes(colKey[attrIdx])\n        ) {\n          colLabelClass += ' active';\n        }\n\n        const rowSpan = 1 + (attrIdx === colAttrs.length - 1 ? rowIncrSpan : 0);\n        const flatColKey = flatKey(colKey.slice(0, attrIdx + 1));\n        const onArrowClick = needToggle ? this.toggleColKey(flatColKey) : null;\n\n        const headerCellFormattedValue =\n          dateFormatters &&\n          dateFormatters[attrName] &&\n          typeof dateFormatters[attrName] === 'function'\n            ? dateFormatters[attrName](colKey[attrIdx])\n            : colKey[attrIdx];\n        attrValueCells.push(\n          <th\n            className={colLabelClass}\n            key={`colKey-${flatColKey}`}\n            colSpan={colSpan}\n            rowSpan={rowSpan}\n            role=\"columnheader button\"\n            onClick={this.clickHeaderHandler(\n              pivotData,\n              colKey,\n              this.props.cols,\n              attrIdx,\n              this.props.tableOptions.clickColumnHeaderCallback,\n            )}\n            onContextMenu={handleContextMenu}\n          >\n            {displayHeaderCell(\n              needToggle,\n              this.state.collapsedCols[flatColKey]\n                ? arrowCollapsed\n                : arrowExpanded,\n              onArrowClick,\n              headerCellFormattedValue,\n              namesMapping,\n              allowRenderHtml,\n            )}\n          </th>,\n        );\n      } else if (attrIdx === colKey.length) {\n        const rowSpan = colAttrs.length - colKey.length + rowIncrSpan;\n        attrValueCells.push(\n          <th\n            className={`${colLabelClass} pvtSubtotalLabel`}\n            key={`colKeyBuffer-${flatKey(colKey)}`}\n            colSpan={colSpan}\n            rowSpan={rowSpan}\n            role=\"columnheader button\"\n            onClick={this.clickHeaderHandler(\n              pivotData,\n              colKey,\n              this.props.cols,\n              attrIdx,\n              this.props.tableOptions.clickColumnHeaderCallback,\n              true,\n            )}\n          >\n            {t('Subtotal')}\n          </th>,\n        );\n      }\n      // The next colSpan columns will have the same value anyway...\n      i += colSpan;\n    }\n\n    const totalCell =\n      attrIdx === 0 && rowTotals ? (\n        <th\n          key=\"total\"\n          className=\"pvtTotalLabel\"\n          rowSpan={colAttrs.length + Math.min(rowAttrs.length, 1)}\n          role=\"columnheader button\"\n          onClick={this.clickHeaderHandler(\n            pivotData,\n            [],\n            this.props.cols,\n            attrIdx,\n            this.props.tableOptions.clickColumnHeaderCallback,\n            false,\n            true,\n          )}\n        >\n          {t('Total (%(aggregatorName)s)', {\n            aggregatorName: t(this.props.aggregatorName),\n          })}\n        </th>\n      ) : null;\n\n    const cells = [spaceCell, attrNameCell, ...attrValueCells, totalCell];\n    return <tr key={`colAttr-${attrIdx}`}>{cells}</tr>;\n  }\n\n  renderRowHeaderRow(pivotSettings) {\n    // Render just the attribute names of the rows (the actual attribute values\n    // will show up in the individual rows).\n\n    const {\n      rowAttrs,\n      colAttrs,\n      rowKeys,\n      arrowCollapsed,\n      arrowExpanded,\n      rowSubtotalDisplay,\n      maxRowVisible,\n      pivotData,\n      namesMapping,\n      allowRenderHtml,\n    } = pivotSettings;\n    return (\n      <tr key=\"rowHdr\">\n        {rowAttrs.map((r, i) => {\n          const needLabelToggle =\n            rowSubtotalDisplay.enabled && i !== rowAttrs.length - 1;\n          let arrowClickHandle = null;\n          let subArrow = null;\n          if (needLabelToggle) {\n            arrowClickHandle =\n              i + 1 < maxRowVisible\n                ? this.collapseAttr(true, i, rowKeys)\n                : this.expandAttr(true, i, rowKeys);\n            subArrow = i + 1 < maxRowVisible ? arrowExpanded : arrowCollapsed;\n          }\n          return (\n            <th className=\"pvtAxisLabel\" key={`rowAttr-${i}`}>\n              {displayHeaderCell(\n                needLabelToggle,\n                subArrow,\n                arrowClickHandle,\n                r,\n                namesMapping,\n                allowRenderHtml,\n              )}\n            </th>\n          );\n        })}\n        <th\n          className=\"pvtTotalLabel\"\n          key=\"padding\"\n          role=\"columnheader button\"\n          onClick={this.clickHeaderHandler(\n            pivotData,\n            [],\n            this.props.rows,\n            0,\n            this.props.tableOptions.clickRowHeaderCallback,\n            false,\n            true,\n          )}\n        >\n          {colAttrs.length === 0\n            ? t('Total (%(aggregatorName)s)', {\n                aggregatorName: t(this.props.aggregatorName),\n              })\n            : null}\n        </th>\n      </tr>\n    );\n  }\n\n  renderTableRow(rowKey, rowIdx, pivotSettings) {\n    // Render a single row in the pivot table.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      rowAttrSpans,\n      visibleColKeys,\n      pivotData,\n      rowTotals,\n      rowSubtotalDisplay,\n      arrowExpanded,\n      arrowCollapsed,\n      cellCallbacks,\n      rowTotalCallbacks,\n      namesMapping,\n      allowRenderHtml,\n    } = pivotSettings;\n\n    const {\n      highlightHeaderCellsOnHover,\n      omittedHighlightHeaderGroups = [],\n      highlightedHeaderCells,\n      cellColorFormatters,\n      dateFormatters,\n    } = this.props.tableOptions;\n    const flatRowKey = flatKey(rowKey);\n\n    const colIncrSpan = colAttrs.length !== 0 ? 1 : 0;\n    const attrValueCells = rowKey.map((r, i) => {\n      let handleContextMenu;\n      let valueCellClassName = 'pvtRowLabel';\n      if (!omittedHighlightHeaderGroups.includes(rowAttrs[i])) {\n        if (highlightHeaderCellsOnHover) {\n          valueCellClassName += ' hoverable';\n        }\n        handleContextMenu = e =>\n          this.props.onContextMenu(e, undefined, rowKey, {\n            [rowAttrs[i]]: r,\n          });\n      }\n      if (\n        highlightedHeaderCells &&\n        Array.isArray(highlightedHeaderCells[rowAttrs[i]]) &&\n        highlightedHeaderCells[rowAttrs[i]].includes(r)\n      ) {\n        valueCellClassName += ' active';\n      }\n      const rowSpan = rowAttrSpans[rowIdx][i];\n      if (rowSpan > 0) {\n        const flatRowKey = flatKey(rowKey.slice(0, i + 1));\n        const colSpan = 1 + (i === rowAttrs.length - 1 ? colIncrSpan : 0);\n        const needRowToggle =\n          rowSubtotalDisplay.enabled && i !== rowAttrs.length - 1;\n        const onArrowClick = needRowToggle\n          ? this.toggleRowKey(flatRowKey)\n          : null;\n\n        const headerCellFormattedValue =\n          dateFormatters && dateFormatters[rowAttrs[i]]\n            ? dateFormatters[rowAttrs[i]](r)\n            : r;\n        return (\n          <th\n            key={`rowKeyLabel-${i}`}\n            className={valueCellClassName}\n            rowSpan={rowSpan}\n            colSpan={colSpan}\n            role=\"columnheader button\"\n            onClick={this.clickHeaderHandler(\n              pivotData,\n              rowKey,\n              this.props.rows,\n              i,\n              this.props.tableOptions.clickRowHeaderCallback,\n            )}\n            onContextMenu={handleContextMenu}\n          >\n            {displayHeaderCell(\n              needRowToggle,\n              this.state.collapsedRows[flatRowKey]\n                ? arrowCollapsed\n                : arrowExpanded,\n              onArrowClick,\n              headerCellFormattedValue,\n              namesMapping,\n              allowRenderHtml,\n            )}\n          </th>\n        );\n      }\n      return null;\n    });\n\n    const attrValuePaddingCell =\n      rowKey.length < rowAttrs.length ? (\n        <th\n          className=\"pvtRowLabel pvtSubtotalLabel\"\n          key=\"rowKeyBuffer\"\n          colSpan={rowAttrs.length - rowKey.length + colIncrSpan}\n          rowSpan={1}\n          role=\"columnheader button\"\n          onClick={this.clickHeaderHandler(\n            pivotData,\n            rowKey,\n            this.props.rows,\n            rowKey.length,\n            this.props.tableOptions.clickRowHeaderCallback,\n            true,\n          )}\n        >\n          {t('Subtotal')}\n        </th>\n      ) : null;\n\n    const rowClickHandlers = cellCallbacks[flatRowKey] || {};\n    const valueCells = visibleColKeys.map(colKey => {\n      const flatColKey = flatKey(colKey);\n      const agg = pivotData.getAggregator(rowKey, colKey);\n      const aggValue = agg.value();\n\n      const keys = [...rowKey, ...colKey];\n      let backgroundColor;\n      if (cellColorFormatters) {\n        Object.values(cellColorFormatters).forEach(cellColorFormatter => {\n          if (Array.isArray(cellColorFormatter)) {\n            keys.forEach(key => {\n              if (backgroundColor) {\n                return;\n              }\n              cellColorFormatter\n                .filter(formatter => formatter.column === key)\n                .forEach(formatter => {\n                  const formatterResult = formatter.getColorFromValue(aggValue);\n                  if (formatterResult) {\n                    backgroundColor = formatterResult;\n                  }\n                });\n            });\n          }\n        });\n      }\n\n      const style = agg.isSubtotal\n        ? { fontWeight: 'bold' }\n        : { backgroundColor };\n\n      return (\n        <td\n          role=\"gridcell\"\n          className=\"pvtVal\"\n          key={`pvtVal-${flatColKey}`}\n          onClick={rowClickHandlers[flatColKey]}\n          onContextMenu={e => this.props.onContextMenu(e, colKey, rowKey)}\n          style={style}\n        >\n          {agg.format(aggValue)}\n        </td>\n      );\n    });\n\n    let totalCell = null;\n    if (rowTotals) {\n      const agg = pivotData.getAggregator(rowKey, []);\n      const aggValue = agg.value();\n      totalCell = (\n        <td\n          role=\"gridcell\"\n          key=\"total\"\n          className=\"pvtTotal\"\n          onClick={rowTotalCallbacks[flatRowKey]}\n          onContextMenu={e => this.props.onContextMenu(e, undefined, rowKey)}\n        >\n          {agg.format(aggValue)}\n        </td>\n      );\n    }\n\n    const rowCells = [\n      ...attrValueCells,\n      attrValuePaddingCell,\n      ...valueCells,\n      totalCell,\n    ];\n\n    return <tr key={`keyRow-${flatRowKey}`}>{rowCells}</tr>;\n  }\n\n  renderTotalsRow(pivotSettings) {\n    // Render the final totals rows that has the totals for all the columns.\n\n    const {\n      rowAttrs,\n      colAttrs,\n      visibleColKeys,\n      rowTotals,\n      pivotData,\n      colTotalCallbacks,\n      grandTotalCallback,\n    } = pivotSettings;\n\n    const totalLabelCell = (\n      <th\n        key=\"label\"\n        className=\"pvtTotalLabel pvtRowTotalLabel\"\n        colSpan={rowAttrs.length + Math.min(colAttrs.length, 1)}\n        role=\"columnheader button\"\n        onClick={this.clickHeaderHandler(\n          pivotData,\n          [],\n          this.props.rows,\n          0,\n          this.props.tableOptions.clickRowHeaderCallback,\n          false,\n          true,\n        )}\n      >\n        {t('Total (%(aggregatorName)s)', {\n          aggregatorName: t(this.props.aggregatorName),\n        })}\n      </th>\n    );\n\n    const totalValueCells = visibleColKeys.map(colKey => {\n      const flatColKey = flatKey(colKey);\n      const agg = pivotData.getAggregator([], colKey);\n      const aggValue = agg.value();\n\n      return (\n        <td\n          role=\"gridcell\"\n          className=\"pvtTotal pvtRowTotal\"\n          key={`total-${flatColKey}`}\n          onClick={colTotalCallbacks[flatColKey]}\n          onContextMenu={e => this.props.onContextMenu(e, colKey, undefined)}\n          style={{ padding: '5px' }}\n        >\n          {agg.format(aggValue)}\n        </td>\n      );\n    });\n\n    let grandTotalCell = null;\n    if (rowTotals) {\n      const agg = pivotData.getAggregator([], []);\n      const aggValue = agg.value();\n      grandTotalCell = (\n        <td\n          role=\"gridcell\"\n          key=\"total\"\n          className=\"pvtGrandTotal pvtRowTotal\"\n          onClick={grandTotalCallback}\n          onContextMenu={e => this.props.onContextMenu(e, undefined, undefined)}\n        >\n          {agg.format(aggValue)}\n        </td>\n      );\n    }\n\n    const totalCells = [totalLabelCell, ...totalValueCells, grandTotalCell];\n\n    return (\n      <tr key=\"total\" className=\"pvtRowTotals\">\n        {totalCells}\n      </tr>\n    );\n  }\n\n  visibleKeys(keys, collapsed, numAttrs, subtotalDisplay) {\n    return keys.filter(\n      key =>\n        // Is the key hidden by one of its parents?\n        !key.some((k, j) => collapsed[flatKey(key.slice(0, j))]) &&\n        // Leaf key.\n        (key.length === numAttrs ||\n          // Children hidden. Must show total.\n          flatKey(key) in collapsed ||\n          // Don't hide totals.\n          !subtotalDisplay.hideOnExpand),\n    );\n  }\n\n  isDashboardEditMode() {\n    return document.contains(document.querySelector('.dashboard--editing'));\n  }\n\n  render() {\n    if (this.cachedProps !== this.props) {\n      this.cachedProps = this.props;\n      this.cachedBasePivotSettings = this.getBasePivotSettings();\n    }\n    const {\n      colAttrs,\n      rowAttrs,\n      rowKeys,\n      colKeys,\n      colTotals,\n      rowSubtotalDisplay,\n      colSubtotalDisplay,\n      allowRenderHtml,\n    } = this.cachedBasePivotSettings;\n\n    // Need to account for exclusions to compute the effective row\n    // and column keys.\n    const visibleRowKeys = this.visibleKeys(\n      rowKeys,\n      this.state.collapsedRows,\n      rowAttrs.length,\n      rowSubtotalDisplay,\n    );\n    const visibleColKeys = this.visibleKeys(\n      colKeys,\n      this.state.collapsedCols,\n      colAttrs.length,\n      colSubtotalDisplay,\n    );\n\n    const pivotSettings = {\n      visibleRowKeys,\n      maxRowVisible: Math.max(...visibleRowKeys.map(k => k.length)),\n      visibleColKeys,\n      maxColVisible: Math.max(...visibleColKeys.map(k => k.length)),\n      rowAttrSpans: this.calcAttrSpans(visibleRowKeys, rowAttrs.length),\n      colAttrSpans: this.calcAttrSpans(visibleColKeys, colAttrs.length),\n      allowRenderHtml,\n      ...this.cachedBasePivotSettings,\n    };\n\n    return (\n      <Styles isDashboardEditMode={this.isDashboardEditMode()}>\n        <table className=\"pvtTable\" role=\"grid\">\n          <thead>\n            {colAttrs.map((c, j) =>\n              this.renderColHeaderRow(c, j, pivotSettings),\n            )}\n            {rowAttrs.length !== 0 && this.renderRowHeaderRow(pivotSettings)}\n          </thead>\n          <tbody>\n            {visibleRowKeys.map((r, i) =>\n              this.renderTableRow(r, i, pivotSettings),\n            )}\n            {colTotals && this.renderTotalsRow(pivotSettings)}\n          </tbody>\n        </table>\n      </Styles>\n    );\n  }\n}\n\nTableRenderer.propTypes = {\n  ...PivotData.propTypes,\n  tableOptions: PropTypes.object,\n  onContextMenu: PropTypes.func,\n};\nTableRenderer.defaultProps = { ...PivotData.defaultProps, tableOptions: {} };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { PureComponent } from 'react';\nimport { TableRenderer } from './TableRenderers';\n\nclass PivotTable extends PureComponent {\n  render() {\n    return <TableRenderer {...this.props} />;\n  }\n}\n\nPivotTable.propTypes = TableRenderer.propTypes;\nPivotTable.defaultProps = TableRenderer.defaultProps;\n\nexport default PivotTable;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useMemo } from 'react';\nimport { MinusSquareOutlined, PlusSquareOutlined } from '@ant-design/icons';\nimport {\n  AdhocMetric,\n  BinaryQueryObjectFilterClause,\n  CurrencyFormatter,\n  DataRecordValue,\n  FeatureFlag,\n  getColumnLabel,\n  getNumberFormatter,\n  getSelectedText,\n  isAdhocColumn,\n  isFeatureEnabled,\n  isPhysicalColumn,\n  NumberFormatter,\n  styled,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport { aggregatorTemplates, PivotTable, sortAs } from './react-pivottable';\nimport {\n  FilterType,\n  MetricsLayoutEnum,\n  PivotTableProps,\n  PivotTableStylesProps,\n  SelectedFiltersType,\n} from './types';\n\nconst Styles = styled.div<PivotTableStylesProps>`\n  ${({ height, width, margin }) => `\n      margin: ${margin}px;\n      height: ${height - margin * 2}px;\n      width: ${\n        typeof width === 'string' ? parseInt(width, 10) : width - margin * 2\n      }px;\n `}\n`;\n\nconst PivotTableWrapper = styled.div`\n  height: 100%;\n  max-width: inherit;\n  overflow: auto;\n`;\n\nconst METRIC_KEY = t('Metric');\nconst vals = ['value'];\n\nconst StyledPlusSquareOutlined = styled(PlusSquareOutlined)`\n  stroke: ${({ theme }) => theme.colors.grayscale.light2};\n  stroke-width: 16px;\n`;\n\nconst StyledMinusSquareOutlined = styled(MinusSquareOutlined)`\n  stroke: ${({ theme }) => theme.colors.grayscale.light2};\n  stroke-width: 16px;\n`;\n\nconst aggregatorsFactory = (formatter: NumberFormatter) => ({\n  Count: aggregatorTemplates.count(formatter),\n  'Count Unique Values': aggregatorTemplates.countUnique(formatter),\n  'List Unique Values': aggregatorTemplates.listUnique(', ', formatter),\n  Sum: aggregatorTemplates.sum(formatter),\n  Average: aggregatorTemplates.average(formatter),\n  Median: aggregatorTemplates.median(formatter),\n  'Sample Variance': aggregatorTemplates.var(1, formatter),\n  'Sample Standard Deviation': aggregatorTemplates.stdev(1, formatter),\n  Minimum: aggregatorTemplates.min(formatter),\n  Maximum: aggregatorTemplates.max(formatter),\n  First: aggregatorTemplates.first(formatter),\n  Last: aggregatorTemplates.last(formatter),\n  'Sum as Fraction of Total': aggregatorTemplates.fractionOf(\n    aggregatorTemplates.sum(),\n    'total',\n    formatter,\n  ),\n  'Sum as Fraction of Rows': aggregatorTemplates.fractionOf(\n    aggregatorTemplates.sum(),\n    'row',\n    formatter,\n  ),\n  'Sum as Fraction of Columns': aggregatorTemplates.fractionOf(\n    aggregatorTemplates.sum(),\n    'col',\n    formatter,\n  ),\n  'Count as Fraction of Total': aggregatorTemplates.fractionOf(\n    aggregatorTemplates.count(),\n    'total',\n    formatter,\n  ),\n  'Count as Fraction of Rows': aggregatorTemplates.fractionOf(\n    aggregatorTemplates.count(),\n    'row',\n    formatter,\n  ),\n  'Count as Fraction of Columns': aggregatorTemplates.fractionOf(\n    aggregatorTemplates.count(),\n    'col',\n    formatter,\n  ),\n});\n\n/* If you change this logic, please update the corresponding Python\n * function (https://github.com/apache/superset/blob/master/superset/charts/post_processing.py),\n * or reach out to @betodealmeida.\n */\nexport default function PivotTableChart(props: PivotTableProps) {\n  const {\n    data,\n    height,\n    width,\n    groupbyRows: groupbyRowsRaw,\n    groupbyColumns: groupbyColumnsRaw,\n    metrics,\n    colOrder,\n    rowOrder,\n    aggregateFunction,\n    transposePivot,\n    combineMetric,\n    rowSubtotalPosition,\n    colSubtotalPosition,\n    colTotals,\n    colSubTotals,\n    rowTotals,\n    rowSubTotals,\n    valueFormat,\n    currencyFormat,\n    emitCrossFilters,\n    setDataMask,\n    selectedFilters,\n    verboseMap,\n    columnFormats,\n    currencyFormats,\n    metricsLayout,\n    metricColorFormatters,\n    dateFormatters,\n    onContextMenu,\n    timeGrainSqla,\n    allowRenderHtml,\n  } = props;\n\n  const theme = useTheme();\n  const defaultFormatter = useMemo(\n    () =>\n      currencyFormat?.symbol\n        ? new CurrencyFormatter({\n            currency: currencyFormat,\n            d3Format: valueFormat,\n          })\n        : getNumberFormatter(valueFormat),\n    [valueFormat, currencyFormat],\n  );\n  const customFormatsArray = useMemo(\n    () =>\n      Array.from(\n        new Set([\n          ...Object.keys(columnFormats || {}),\n          ...Object.keys(currencyFormats || {}),\n        ]),\n      ).map(metricName => [\n        metricName,\n        columnFormats[metricName] || valueFormat,\n        currencyFormats[metricName] || currencyFormat,\n      ]),\n    [columnFormats, currencyFormat, currencyFormats, valueFormat],\n  );\n  const hasCustomMetricFormatters = customFormatsArray.length > 0;\n  const metricFormatters = useMemo(\n    () =>\n      hasCustomMetricFormatters\n        ? {\n            [METRIC_KEY]: Object.fromEntries(\n              customFormatsArray.map(([metric, d3Format, currency]) => [\n                metric,\n                currency\n                  ? new CurrencyFormatter({\n                      currency,\n                      d3Format,\n                    })\n                  : getNumberFormatter(d3Format),\n              ]),\n            ),\n          }\n        : undefined,\n    [customFormatsArray, hasCustomMetricFormatters],\n  );\n\n  const metricNames = useMemo(\n    () =>\n      metrics.map((metric: string | AdhocMetric) =>\n        typeof metric === 'string' ? metric : (metric.label as string),\n      ),\n    [metrics],\n  );\n\n  const unpivotedData = useMemo(\n    () =>\n      data.reduce(\n        (acc: Record<string, any>[], record: Record<string, any>) => [\n          ...acc,\n          ...metricNames\n            .map((name: string) => ({\n              ...record,\n              [METRIC_KEY]: name,\n              value: record[name],\n            }))\n            .filter(record => record.value !== null),\n        ],\n        [],\n      ),\n    [data, metricNames],\n  );\n  const groupbyRows = useMemo(\n    () => groupbyRowsRaw.map(getColumnLabel),\n    [groupbyRowsRaw],\n  );\n  const groupbyColumns = useMemo(\n    () => groupbyColumnsRaw.map(getColumnLabel),\n    [groupbyColumnsRaw],\n  );\n\n  const sorters = useMemo(\n    () => ({\n      [METRIC_KEY]: sortAs(metricNames),\n    }),\n    [metricNames],\n  );\n\n  const [rows, cols] = useMemo(() => {\n    let [rows_, cols_] = transposePivot\n      ? [groupbyColumns, groupbyRows]\n      : [groupbyRows, groupbyColumns];\n\n    if (metricsLayout === MetricsLayoutEnum.ROWS) {\n      rows_ = combineMetric ? [...rows_, METRIC_KEY] : [METRIC_KEY, ...rows_];\n    } else {\n      cols_ = combineMetric ? [...cols_, METRIC_KEY] : [METRIC_KEY, ...cols_];\n    }\n    return [rows_, cols_];\n  }, [\n    combineMetric,\n    groupbyColumns,\n    groupbyRows,\n    metricsLayout,\n    transposePivot,\n  ]);\n\n  const handleChange = useCallback(\n    (filters: SelectedFiltersType) => {\n      const filterKeys = Object.keys(filters);\n      const groupby = [...groupbyRowsRaw, ...groupbyColumnsRaw];\n      setDataMask({\n        extraFormData: {\n          filters:\n            filterKeys.length === 0\n              ? undefined\n              : filterKeys.map(key => {\n                  const val = filters?.[key];\n                  const col =\n                    groupby.find(item => {\n                      if (isPhysicalColumn(item)) {\n                        return item === key;\n                      }\n                      if (isAdhocColumn(item)) {\n                        return item.label === key;\n                      }\n                      return false;\n                    }) ?? '';\n                  if (val === null || val === undefined)\n                    return {\n                      col,\n                      op: 'IS NULL',\n                    };\n                  return {\n                    col,\n                    op: 'IN',\n                    val: val as (string | number | boolean)[],\n                  };\n                }),\n        },\n        filterState: {\n          value:\n            filters && Object.keys(filters).length\n              ? Object.values(filters)\n              : null,\n          selectedFilters:\n            filters && Object.keys(filters).length ? filters : null,\n        },\n      });\n    },\n    [groupbyColumnsRaw, groupbyRowsRaw, setDataMask],\n  );\n\n  const getCrossFilterDataMask = useCallback(\n    (value: { [key: string]: string }) => {\n      const isActiveFilterValue = (key: string, val: DataRecordValue) =>\n        !!selectedFilters && selectedFilters[key]?.includes(val);\n\n      if (!value) {\n        return undefined;\n      }\n\n      const [key, val] = Object.entries(value)[0];\n      let values = { ...selectedFilters };\n      if (isActiveFilterValue(key, val)) {\n        values = {};\n      } else {\n        values = { [key]: [val] };\n      }\n\n      const filterKeys = Object.keys(values);\n      const groupby = [...groupbyRowsRaw, ...groupbyColumnsRaw];\n      return {\n        dataMask: {\n          extraFormData: {\n            filters:\n              filterKeys.length === 0\n                ? undefined\n                : filterKeys.map(key => {\n                    const val = values?.[key];\n                    const col =\n                      groupby.find(item => {\n                        if (isPhysicalColumn(item)) {\n                          return item === key;\n                        }\n                        if (isAdhocColumn(item)) {\n                          return item.label === key;\n                        }\n                        return false;\n                      }) ?? '';\n                    if (val === null || val === undefined)\n                      return {\n                        col,\n                        op: 'IS NULL' as const,\n                      };\n                    return {\n                      col,\n                      op: 'IN' as const,\n                      val: val as (string | number | boolean)[],\n                    };\n                  }),\n          },\n          filterState: {\n            value:\n              values && Object.keys(values).length\n                ? Object.values(values)\n                : null,\n            selectedFilters:\n              values && Object.keys(values).length ? values : null,\n          },\n        },\n        isCurrentValueSelected: isActiveFilterValue(key, val),\n      };\n    },\n    [groupbyColumnsRaw, groupbyRowsRaw, selectedFilters],\n  );\n\n  const toggleFilter = useCallback(\n    (\n      e: MouseEvent,\n      value: string,\n      filters: FilterType,\n      pivotData: Record<string, any>,\n      isSubtotal: boolean,\n      isGrandTotal: boolean,\n    ) => {\n      if (isSubtotal || isGrandTotal || !emitCrossFilters) {\n        return;\n      }\n\n      // allow selecting text in a cell\n      if (getSelectedText()) {\n        return;\n      }\n\n      const isActiveFilterValue = (key: string, val: DataRecordValue) =>\n        !!selectedFilters && selectedFilters[key]?.includes(val);\n\n      const filtersCopy = { ...filters };\n      delete filtersCopy[METRIC_KEY];\n\n      const filtersEntries = Object.entries(filtersCopy);\n      if (filtersEntries.length === 0) {\n        return;\n      }\n\n      const [key, val] = filtersEntries[filtersEntries.length - 1];\n\n      let updatedFilters = { ...(selectedFilters || {}) };\n      // multi select\n      // if (selectedFilters && isActiveFilterValue(key, val)) {\n      //   updatedFilters[key] = selectedFilters[key].filter((x: DataRecordValue) => x !== val);\n      // } else {\n      //   updatedFilters[key] = [...(selectedFilters?.[key] || []), val];\n      // }\n      // single select\n      if (selectedFilters && isActiveFilterValue(key, val)) {\n        updatedFilters = {};\n      } else {\n        updatedFilters = {\n          [key]: [val],\n        };\n      }\n      if (\n        Array.isArray(updatedFilters[key]) &&\n        updatedFilters[key].length === 0\n      ) {\n        delete updatedFilters[key];\n      }\n      handleChange(updatedFilters);\n    },\n    [emitCrossFilters, selectedFilters, handleChange],\n  );\n\n  const tableOptions = useMemo(\n    () => ({\n      clickRowHeaderCallback: toggleFilter,\n      clickColumnHeaderCallback: toggleFilter,\n      colTotals,\n      colSubTotals,\n      rowTotals,\n      rowSubTotals,\n      highlightHeaderCellsOnHover:\n        emitCrossFilters ||\n        isFeatureEnabled(FeatureFlag.DrillBy) ||\n        isFeatureEnabled(FeatureFlag.DrillToDetail),\n      highlightedHeaderCells: selectedFilters,\n      omittedHighlightHeaderGroups: [METRIC_KEY],\n      cellColorFormatters: { [METRIC_KEY]: metricColorFormatters },\n      dateFormatters,\n    }),\n    [\n      colTotals,\n      colSubTotals,\n      dateFormatters,\n      emitCrossFilters,\n      metricColorFormatters,\n      rowTotals,\n      rowSubTotals,\n      selectedFilters,\n      toggleFilter,\n    ],\n  );\n\n  const subtotalOptions = useMemo(\n    () => ({\n      colSubtotalDisplay: { displayOnTop: colSubtotalPosition },\n      rowSubtotalDisplay: { displayOnTop: rowSubtotalPosition },\n      arrowCollapsed: <StyledPlusSquareOutlined />,\n      arrowExpanded: <StyledMinusSquareOutlined />,\n    }),\n    [colSubtotalPosition, rowSubtotalPosition],\n  );\n\n  const handleContextMenu = useCallback(\n    (\n      e: MouseEvent,\n      colKey: (string | number | boolean)[] | undefined,\n      rowKey: (string | number | boolean)[] | undefined,\n      dataPoint: { [key: string]: string },\n    ) => {\n      if (onContextMenu) {\n        e.preventDefault();\n        e.stopPropagation();\n        const drillToDetailFilters: BinaryQueryObjectFilterClause[] = [];\n        if (colKey && colKey.length > 1) {\n          colKey.forEach((val, i) => {\n            const col = cols[i];\n            const formatter = dateFormatters[col];\n            const formattedVal = formatter?.(val as number) || String(val);\n            if (i > 0) {\n              drillToDetailFilters.push({\n                col,\n                op: '==',\n                val,\n                formattedVal,\n                grain: formatter ? timeGrainSqla : undefined,\n              });\n            }\n          });\n        }\n        if (rowKey) {\n          rowKey.forEach((val, i) => {\n            const col = rows[i];\n            const formatter = dateFormatters[col];\n            const formattedVal = formatter?.(val as number) || String(val);\n            drillToDetailFilters.push({\n              col,\n              op: '==',\n              val,\n              formattedVal,\n              grain: formatter ? timeGrainSqla : undefined,\n            });\n          });\n        }\n        onContextMenu(e.clientX, e.clientY, {\n          drillToDetail: drillToDetailFilters,\n          crossFilter: getCrossFilterDataMask(dataPoint),\n          drillBy: dataPoint && {\n            filters: [\n              {\n                col: Object.keys(dataPoint)[0],\n                op: '==',\n                val: Object.values(dataPoint)[0],\n              },\n            ],\n            groupbyFieldName: rowKey ? 'groupbyRows' : 'groupbyColumns',\n          },\n        });\n      }\n    },\n    [\n      cols,\n      dateFormatters,\n      getCrossFilterDataMask,\n      onContextMenu,\n      rows,\n      timeGrainSqla,\n    ],\n  );\n\n  return (\n    <Styles height={height} width={width} margin={theme.gridUnit * 4}>\n      <PivotTableWrapper>\n        <PivotTable\n          data={unpivotedData}\n          rows={rows}\n          cols={cols}\n          aggregatorsFactory={aggregatorsFactory}\n          defaultFormatter={defaultFormatter}\n          customFormatters={metricFormatters}\n          aggregatorName={aggregateFunction}\n          vals={vals}\n          colOrder={colOrder}\n          rowOrder={rowOrder}\n          sorters={sorters}\n          tableOptions={tableOptions}\n          subtotalOptions={subtotalOptions}\n          namesMapping={verboseMap}\n          onContextMenu={handleContextMenu}\n          allowRenderHtml={allowRenderHtml}\n        />\n      </PivotTableWrapper>\n    </Styles>\n  );\n}\n"],"names":["getSelectedText","_window$getSelection","window","getSelection","toString","PlusSquareOutlined","props","ref","AntdIcon","A","icon","MinusSquareOutlined","numberFormat","optsIn","opts","digitsAfterDecimal","scaler","thousandsSep","decimalSep","prefix","suffix","x","Number","isNaN","isFinite","result","nStr","String","split","x1","x2","length","rgx","test","replace","addSeparators","toFixed","rx","rd","rz","naturalSort","as","bs","nas","nbs","a","b","match","a1","shift","b1","sortAs","order","mapping","lMapping","forEach","element","i","toLowerCase","getSort","sorters","attr","sort","usFmt","usFmtInt","usFmtPct","fmtNonString","formatter","baseAggregatorTemplates","count","push","this","value","format","uniques","fn","uniq","record","Array","from","includes","numInputs","sum","parseFloat","extremes","mode","data","val","sorter","coercedValue","Math","quantile","q","vals","strMap","Object","keys","values","middle","floor","ceil","runningStat","ddof","n","m","s","strValue","mNew","sqrt","Error","sumOverSum","num","denom","sumNum","sumDenom","fractionOf","wrapped","type","rowKey","colKey","selector","total","row","col","inner","acc","getAggregator","extendedAggregatorTemplates","countUnique","f","listUnique","join","max","min","first","last","median","average","var","stdev","aggregatorTemplates","aggregators","Count","tpl","Sum","Average","Median","Minimum","Maximum","First","Last","flatKey","attrVals","fromCharCode","PivotData","constructor","inputProps","subtotals","defaultProps","processRecord","bind","PropTypes","propTypes","aggregator","aggregatorsFactory","defaultFormatter","aggregatorName","formattedAggregators","customFormatters","entries","reduce","key","columnFormatter","column","tree","rowKeys","colKeys","rowTotals","colTotals","allTotal","sorted","forEachRecord","getFormattedAggregator","totalsKeys","groupName","groupValue","find","name","arrSort","attrs","partialOnTop","reverse","sortersArr","map","limit","comparison","sortKeys","v","r","c","rowOrder","rows","rowPartialOnTop","colOrder","cols","colPartialOnTop","getColKeys","getRowKeys","rowStart","rowEnabled","colStart","colEnabled","isRowSubtotal","isColSubtotal","ri","fRowKey","slice","flatRowKey","isSubtotal","ci","fColKey","flatColKey","agg","input","isArray","t","isRequired","valueFilter","derivedAttributes","Styles","styled","div","theme","isDashboardEditMode","css","gridUnit","typography","sizes","families","sansSerif","colors","grayscale","light5","light2","weights","normal","primary","light3","bold","dark2","light4","displayHeaderCell","needToggle","ArrowIcon","onArrowClick","namesMapping","allowRenderHtml","parsedLabel","parseLabel","labelContent","safeHtmlSpan","_jsxs","className","children","_jsx","role","tabIndex","onClick","TableRenderer","Component","super","state","collapsedRows","collapsedCols","clickHeaderHandler","clickHandler","getBasePivotSettings","colAttrs","rowAttrs","tableOptions","subtotalOptions","arrowCollapsed","arrowExpanded","colSubtotalDisplay","displayOnTop","enabled","colSubTotals","hideOnExpand","rowSubtotalDisplay","rowSubTotals","pivotData","cellCallbacks","rowTotalCallbacks","colTotalCallbacks","grandTotalCallback","clickCallback","rowValues","colValues","filters","colLimit","rowLimit","e","attrIdx","callback","isGrandTotal","collapseAttr","rowOrCol","allKeys","stopPropagation","keyLen","collapsed","filter","k","updates","setState","expandAttr","toggleRowKey","toggleColKey","calcAttrSpans","attrArr","numAttrs","spans","li","lv","cv","ent","depth","renderColHeaderRow","attrName","pivotSettings","visibleColKeys","colAttrSpans","maxColVisible","highlightHeaderCellsOnHover","omittedHighlightHeaderGroups","highlightedHeaderCells","dateFormatters","spaceCell","colSpan","rowSpan","arrowClickHandle","subArrow","attrNameCell","attrValueCells","rowIncrSpan","handleContextMenu","colLabelClass","onContextMenu","undefined","headerCellFormattedValue","clickColumnHeaderCallback","totalCell","cells","renderRowHeaderRow","maxRowVisible","needLabelToggle","clickRowHeaderCallback","renderTableRow","rowIdx","rowAttrSpans","cellColorFormatters","colIncrSpan","valueCellClassName","needRowToggle","attrValuePaddingCell","rowClickHandlers","valueCells","aggValue","backgroundColor","cellColorFormatter","formatterResult","getColorFromValue","style","fontWeight","rowCells","renderTotalsRow","totalLabelCell","totalValueCells","padding","grandTotalCell","totalCells","visibleKeys","subtotalDisplay","some","j","document","contains","querySelector","render","cachedProps","cachedBasePivotSettings","visibleRowKeys","PivotTable","PureComponent","height","width","margin","parseInt","PivotTableWrapper","METRIC_KEY","StyledPlusSquareOutlined","StyledMinusSquareOutlined","PivotTableChart","groupbyRows","groupbyRowsRaw","groupbyColumns","groupbyColumnsRaw","metrics","aggregateFunction","transposePivot","combineMetric","rowSubtotalPosition","colSubtotalPosition","valueFormat","currencyFormat","emitCrossFilters","setDataMask","selectedFilters","verboseMap","columnFormats","currencyFormats","metricsLayout","metricColorFormatters","timeGrainSqla","useTheme","useMemo","symbol","CurrencyFormatter","currency","d3Format","getNumberFormatter","customFormatsArray","Set","metricName","hasCustomMetricFormatters","metricFormatters","fromEntries","metric","metricNames","label","unpivotedData","getColumnLabel","rows_","cols_","MetricsLayoutEnum","ROWS","handleChange","useCallback","filterKeys","groupby","extraFormData","_groupby$find","item","isPhysicalColumn","isAdhocColumn","op","filterState","getCrossFilterDataMask","isActiveFilterValue","_selectedFilters$key","dataMask","_values","_groupby$find2","isCurrentValueSelected","toggleFilter","filtersCopy","filtersEntries","updatedFilters","_selectedFilters$key2","isFeatureEnabled","FeatureFlag","DrillBy","DrillToDetail","dataPoint","preventDefault","drillToDetailFilters","formattedVal","grain","clientX","clientY","drillToDetail","crossFilter","drillBy","groupbyFieldName"],"sourceRoot":""}